export const metadata = {
  title: 'Depot API',
  description:
    "A reference document for how Drop's depot API works, and how downloads are aggregated across different sources.",
}

# Depot API

The depot API is a common layout for all endpoints that offer content downloads for Drop. It's designed to be flexible to allow almost any arrangement of depot types.

## Notes

Some implementation decisions around depots may seem strange, but depots are designed to:

- operate over HTTP
- enforce access control (only Drop users can download)
- be static (no server-side logic)

## Setting up a depot

On first setup, depots provide the admins with a static symmetric encryption key. This is used to **decrypt responses from depots**. This static encryption key, called the **admin depot key**, is stored privately on the server, and isn't shared with anyone.

The Drop instance then generates a second encryption key, used to encrypt content files. This key, called the **depot key**, is shared with clients so they can decrypt their downloads. This is similar to how Steam's download system operates.

Because the admin depot key can't be shared, all non-content requests are proxied through the Drop server. The only exception is the speedtest endpoint.

---

## Fetch depot manifest {{ tag: 'GET', label: '/manifest' }}

<Row>
  <Col>

    This endpoint fetches a manifest of what content is available on the depot.

  </Col>
  <Col sticky>

    ```json {{ title: 'Response' }}
    {
        "content": {
            "gameid": ["version", "version2"],
            "gameid2": ["version3", "version4"]
        },
        "encryption": "none" // Can be none, gzip, or zstd
    }
    ```

  </Col>
</Row>

---

## Speedtest {{ tag: 'GET', label: '/speedtest' }}

<Row>
  <Col>

    This endpoint is used to determine the speed of the download depot.

  </Col>
  <Col sticky>

    ``` {{ title: 'Response' }}
    50MB of zeroes
    ```

  </Col>
</Row>

---

## Content {{ tag: 'GET', label: '/content/:gameid/:version/:chunkid' }}

<Row>
  <Col>

    This endpoint is used to download content from the depot.

  </Col>
  <Col sticky>

    ``` {{ title: 'Response' }}
    Encrypted, potentially compressed content
    ```

  </Col>
</Row>
